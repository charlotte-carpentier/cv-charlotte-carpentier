{#
=========================
         IMAGE           
=========================
#}

{% macro renderImage(options) %}
  {# Find the target image or images #}
  {% if options.name %}
    {% set imageData = null %}
    
    {# Search for the image by name #}
    {% for image in options.datas.images %}
      {% if image.name == options.name %}
        {% set imageData = image %}
      {% endif %}
    {% endfor %}

    {% set globalStyle = options.datas.globalStyle %}

    {% if imageData %}
      {# Apply variant styling #}
      {% set variantStyle = options.datas.variants[imageData.size] | default('') %}

      {# Construct srcset assuming images exist with suffixes -480, -960, -1440 #}
      {% set baseName = imageData.src | replace('.jpg', '') | replace('.png', '') | replace('.webp', '') %}
      {% set extension = imageData.src | split('.') | last %}
      {% set srcset = baseName ~ '-480.' ~ extension ~ ' 480w, ' ~ baseName ~ '-960.' ~ extension ~ ' 960w, ' ~ baseName ~ '-1440.' ~ extension ~ ' 1440w' %}

      <img 
        src="{{ imageData.src }}" 
        srcset="{{ srcset }}"
        sizes="(max-width: 640px) 480px, (max-width: 1024px) 960px, 1440px"
        alt="{{ imageData.alt }}" 
        class="{{ globalStyle }} {{ variantStyle }} {% if options.className %}{{ options.className }}{% endif %}"
        loading="{{ options.loading | default('lazy') }}"
        decoding="async"
        {% if options.width %}width="{{ options.width }}"{% endif %}
        {% if options.height %}height="{{ options.height }}"{% endif %}
      />
    {% else %}
      <span class="text-red-500">Image not found: {{ options.name }}</span>
    {% endif %}

  {% elseif options.group %}
    {% set groupImages = [] %}
    
    {# Find all images in the specified group #}
    {% for image in options.datas.images %}
      {% if image.group == options.group %}
        {% set groupImages = (groupImages.push(image), groupImages) %}
      {% endif %}
    {% endfor %}
    
    {% if groupImages.length > 0 %}
      <div class="image-group {% if options.groupClass %}{{ options.groupClass }}{% endif %}">
        {% for image in groupImages %}
          {% set variantStyle = options.datas.variants[image.size] | default('') %}
          {% set baseName = image.src | replace('.jpg', '') | replace('.png', '') | replace('.webp', '') %}
          {% set extension = image.src | split('.') | last %}
          {% set srcset = baseName ~ '-480.' ~ extension ~ ' 480w, ' ~ baseName ~ '-960.' ~ extension ~ ' 960w, ' ~ baseName ~ '-1440.' ~ extension ~ ' 1440w' %}

          <div class="image-container">
            <img 
              src="{{ image.src }}" 
              srcset="{{ srcset }}"
              sizes="(max-width: 640px) 480px, (max-width: 1024px) 960px, 1440px"
              alt="{{ image.alt }}" 
              class="{{ options.datas.globalStyle }} {{ variantStyle }} {% if options.imageClass %}{{ options.imageClass }}{% endif %}"
              loading="{{ options.loading | default('lazy') }}"
              decoding="async"
            />
          </div>
        {% endfor %}
      </div>
    {% else %}
      <span class="text-red-500">No images found in group: {{ options.group }}</span>
    {% endif %}

  {% else %}
    {# Direct image rendering with inline properties #}
    {% set globalStyle = options.datas.globalStyle %}
    {% set variantStyle = options.datas.variants[options.size] | default('') %}
    {% set baseName = options.src | replace('.jpg', '') | replace('.png', '') | replace('.webp', '') %}
    {% set extension = options.src | split('.') | last %}
    {% set srcset = baseName ~ '-480.' ~ extension ~ ' 480w, ' ~ baseName ~ '-960.' ~ extension ~ ' 960w, ' ~ baseName ~ '-1440.' ~ extension ~ ' 1440w' %}

    <img 
      src="{{ options.src }}" 
      srcset="{{ srcset }}"
      sizes="(max-width: 640px) 480px, (max-width: 1024px) 960px, 1440px"
      alt="{{ options.alt }}" 
      class="{{ globalStyle }} {{ variantStyle }} {% if options.className %}{{ options.className }}{% endif %}"
      loading="{{ options.loading | default('lazy') }}"
      decoding="async"
      {% if options.width %}width="{{ options.width }}"{% endif %}
      {% if options.height %}height="{{ options.height }}"{% endif %}
    />
  {% endif %}
{% endmacro %}

{#
============================
Summon HAT Components Wisely
============================

1. Import the macro at the top of your page
{% from "03-atoms/image.njk" import renderImage %}

2. Call a specific image by its name
{{ renderImage({ name: "placeholder_medium", datas: atoms.images }) }}

May your bugs be forever exiled to the shadow realm. üßô‚Äç‚ôÇÔ∏è‚ú®
#}
