{#
=========================
      SECTION TEXT        
=========================
#}

{% macro renderSectionText(options) %}
  {# Check if data is provided #}
  {% if options.datas %}
    {# Get global styling #}
    {% set globalStyle = options.datas.globalStyle %}

    {# Find variant without using selectattr #}
    {% set variant = null %}
    {% if options.name and options.datas.sections %}
      {% for item in options.datas.sections %}
        {% if item.name == options.name %}
          {% set variant = item %}
        {% endif %}
      {% endfor %}

      {# If no variant found, use first as default #}
      {% if not variant and options.datas.sections[0] %}
        {% set variant = options.datas.sections[0] %}
      {% endif %}
    {% elif options.datas.sections and options.datas.sections[0] %}
      {% set variant = options.datas.sections[0] %}
    {% else %}
      {% set variant = {} %}
    {% endif %}

    {# Get variant style #}
    {% if variant.variant and options.datas.variants[variant.variant] %}
      {% set variantStyle = options.datas.variants[variant.variant] %}
    {% else %}
      {% set variantStyle = options.datas.variants.default %}
    {% endif %}

    {# Get container styling #}
    {% set containerStyle = options.datas.containerStyle %}
    
    {# Check if image is defined for this section #}
    {% set hasImage = variant.image is defined and variant.image %}
    
    {# Check if section has ONLY an image without text or other content #}
    {% set imageOnlySection = hasImage and not variant.heading and not variant.content and not variant.text and not variant.description and not variant.superHeading and not variant.primaryButton and not variant.secondaryButton and not variant.link and not variant.heading_01 and not variant.content_01 %}
    
    {# Conditional styles based on section type #}
    {% if variant and variant.name == "ma_nautic_plus" %}
      {% set contentLayoutStyle = {
        "mobile": "flex flex-col gap-8",
        "desktop": "md:grid md:grid-cols-2 md:gap-16 md:items-center"
      } %}
      {% set textContainerStyle = options.datas.textContainerStyle ~ " flex flex-col items-center text-center [&_p]:mb-6 max-w-[40rem] mx-auto" %}
      {% set imageContainerStyle = options.datas.imageContainerStyle ~ " flex justify-center mt-6 md:mt-0" %}
    {% elif hasImage and not imageOnlySection %}
      {% set contentLayoutStyle = options.datas.contentLayoutStyle %}
      {% set textContainerStyle = options.datas.textContainerStyle ~ " flex justify-center md:justify-start [&_p]:mb-6 max-w-[40rem] mx-auto" %}
      {% set imageContainerStyle = options.datas.imageContainerStyle ~ " flex justify-center md:justify-start" %}
    {% elif imageOnlySection %}
      {# Specific style for a section with only an image #}
      {% set contentLayoutStyle = {
        "mobile": "flex flex-col items-center justify-center",
        "desktop": "flex items-center justify-center"
      } %}
      {% set textContainerStyle = "hidden" %}
      {% set imageContainerStyle = "w-full flex justify-center items-center" %}
    {% else %}
      {% set contentLayoutStyle = {
        "mobile": "flex flex-col gap-6",
        "desktop": "grid grid-cols-1 gap-8 items-center"
      } %}
      {% set textContainerStyle = options.datas.textContainerStyle ~ " mx-auto max-w-[40rem] text-center [&_p]:mb-6" %}
      {% set imageContainerStyle = "hidden" %}
    {% endif %}
    
    {# Get button container style #}
    {% set buttonsContainerStyle = options.datas.buttonsContainerStyle ~ " flex-row justify-center" %}

    {# Specific to MA-Nautic section text #}
    {% if variant and variant.name == "ma_nautic_discover" %}
      <section class="{{ globalStyle }} {{ variantStyle }} relative overflow-y-auto {{ options.class | default('') }}">
        {# Background image #}
        {% if variant.backgroundImage and options.images and options.images.images %}
          {% set bgImage = null %}
          {% for image in options.images.images %}
            {% if image.name == variant.backgroundImage %}
              {% set bgImage = image %}
            {% endif %}
          {% endfor %}

          {% if bgImage %}
            <div class="absolute inset-0 z-0 ma-nautic-bg-fixed" style="background-image: url('{{ bgImage.src }}');">
              <div class="absolute inset-0 bg-ma-nautic-blue/30"></div>
            </div>
          {% endif %}
        {% endif %}

        {# Content container #}
        <div class="{{ containerStyle }} relative z-10 h-full flex items-center justify-center py-6 md:py-8">
          <div class="flex flex-col items-center justify-center text-center px-4 md:px-6 w-full">
            {# Logo image instead of headings #}
            {% if variant.image and options.images and options.images.images %}
              {% set logoImg = null %}
              {% for image in options.images.images %}
                {% if image.name == variant.image %}
                  {% set logoImg = image %}
                {% endif %}
              {% endfor %}

              {% if logoImg %}
                <div class="mb-6">
                  <img src="{{ logoImg.src }}" alt="{{ logoImg.alt }}" class="{{ options.images.globalStyle }} {{ options.images.variants[logoImg.size] }}">
                </div>
              {% endif %}
            {% endif %}

            {# Multiple content sections - Iterate through numbered content blocks #}
            {% for i in range(1, 4) %}
              {% set headingKey = "heading_0" + i %}
              {% set contentKey = "content_0" + i %}
              
              {% if variant[headingKey] and options.headings and options.headings.headings %}
                {% set subtitle = null %}
                {% for heading in options.headings.headings %}
                  {% if heading.name == variant[headingKey] %}
                    {% set subtitle = heading %}
                  {% endif %}
                {% endfor %}

                {% if subtitle %}
                  <{{ "h" + subtitle.level }} class="{{ options.headings.globalStyle }} {{ options.headings.variants[subtitle.style] }} max-w-[40rem] mx-auto mt-6 text-[theme(--ma-nautic-white)]">
                    {{ subtitle.text }}
                  </{{ "h" + subtitle.level }}>
                {% endif %}
              {% endif %}

              {# Descriptive content for this iteration #}
              {% if variant[contentKey] %}
                <div class="text-sm sm:text-lg max-w-[40rem] my-4 md:my-6 ma-nautic-subtitle [&_p]:mb-[30px] mx-auto text-[theme(--ma-nautic-white)]">
                  {{ variant[contentKey] | safe }}
                </div>
              {% endif %}
            {% endfor %}

            {# "Discover" link - Gets link data via its name #}
            {% if variant.link and options.links and options.links.links %}
              {% set linkData = null %}
              {% for link in options.links.links %}
                {% if link.name | lower == variant.link | lower %}
                  {% set linkData = link %}
                {% endif %}
              {% endfor %}

              {% if linkData %}
                <a href="{{ linkData.href }}" class="{{ options.links.globalStyle }} {{ options.links.variants[linkData.style] }} uppercase mt-4 text-[theme(--ma-nautic-white)]">
                  {{ linkData.text }}
                </a>
              {% else %}
                {# Fallback if link not found in collection #}
                <a href="#" class="uppercase mt-4">
                  {{ variant.link }}
                </a>
              {% endif %}
            {% endif %}
          </div>
        </div>
      </section>

    {# Specific case for a section with only an image (ma_nautic_map) #}
    {% elif imageOnlySection %}
      <section class="{{ globalStyle }} {{ variantStyle }} {{ options.class | default('') }} {% if variant.height %}{{ variant.height }}{% else %}py-16 md:py-20 lg:py-24{% endif %}">
        <div class="{{ containerStyle }}">
          <div class="{{ contentLayoutStyle.mobile }} {{ contentLayoutStyle.desktop }}">
            {# Display centered image #}
            {% if variant.image and options.images and options.images.images %}
              {% set sectionImage = null %}
              {% for image in options.images.images %}
                {% if image.name == variant.image %}
                  {% set sectionImage = image %}
                {% endif %}
              {% endfor %}

              {% if sectionImage %}
                {% set imageVariant = options.images.variants[sectionImage.size] | default('') %}
                <img src="{{ sectionImage.src }}" alt="{{ sectionImage.alt }}" class="{{ options.images.globalStyle }} {{ imageVariant }} mx-auto">
              {% endif %}
            {% endif %}
          </div>
        </div>
      </section>

    {# New specific section for ma_nautic_info #}
    {% elif variant and variant.name == "ma_nautic_info" %}
      <section class="{{ globalStyle }} {{ variantStyle }} {{ options.class | default('') }} {% if variant.heightVariant %}{{ options.datas.heights[variant.heightVariant] }}{% else %}py-16 md:py-20 lg:py-24{% endif %}">
        <div class="{{ containerStyle }}">
          <div class="{{ contentLayoutStyle.mobile }} {{ contentLayoutStyle.desktop }}">
            {# Text Content Column #}
            <div class="{{ textContainerStyle }}">
              {# First title - headingInfo #}
              {% if variant.headingInfo and options.headings and options.headings.headings %}
                {% set infoHeading = null %}
                {% for heading in options.headings.headings %}
                  {% if heading.name == variant.headingInfo %}
                    {% set infoHeading = heading %}
                  {% endif %}
                {% endfor %}

                {% if infoHeading %}
                  <{{ "h" + infoHeading.level }} class="{{ options.headings.globalStyle }} {{ options.headings.sizeStyles["h" + infoHeading.level] }} {{ options.headings.variants[infoHeading.style] }} max-w-[40rem] mx-auto">
                    {{ infoHeading.text }}
                  </{{ "h" + infoHeading.level }}>
                {% endif %}
              {% endif %}

              {# Main information #}
              {% if variant.infos %}
                <div class="my-4 [&_p]:mb-6 max-w-[40rem] mx-auto">
                  {{ variant.infos | safe }}
                </div>
              {% endif %}

              {# Second title - headingExtra #}
              {% if variant.headingExtra and options.headings and options.headings.headings %}
                {% set extraHeading = null %}
                {% for heading in options.headings.headings %}
                  {% if heading.name == variant.headingExtra %}
                    {% set extraHeading = heading %}
                  {% endif %}
                {% endfor %}

                {% if extraHeading %}
                  <{{ "h" + extraHeading.level }} class="{{ options.headings.globalStyle }} {{ options.headings.sizeStyles["h" + extraHeading.level] }} {{ options.headings.variants[extraHeading.style] }} mt-6 max-w-[40rem] mx-auto">
                    {{ extraHeading.text }}
                  </{{ "h" + extraHeading.level }}>
                {% endif %}
              {% endif %}

              {# Additional information #}
              {% if variant.extras %}
                <div class="my-4 [&_p]:mb-6 max-w-[40rem] mx-auto">
                  {{ variant.extras | safe }}
                </div>
              {% endif %}

              {# Standard link if defined #}
              {% if variant.link and options.links and options.links.links %}
                {% set linkData = null %}
                {% for link in options.links.links %}
                  {% if link.name | lower == variant.link | lower %}
                    {% set linkData = link %}
                  {% endif %}
                {% endfor %}

                {% if linkData %}
                  <div class="flex justify-center">
                    <a href="{{ linkData.href }}" class="{{ options.links.globalStyle }} {{ options.links.variants[linkData.style] }} mt-6">
                      {{ linkData.text }}
                    </a>
                  </div>
                {% endif %}
              {% endif %}
            </div>

            {# Image Column #}
            <div class="{{ imageContainerStyle }}">
              {% if variant.image and options.images and options.images.images %}
                {% set sectionImage = null %}
                {% for image in options.images.images %}
                  {% if image.name == variant.image %}
                    {% set sectionImage = image %}
                  {% endif %}
                {% endfor %}

                {% if sectionImage %}
                  {% set imageVariant = options.images.variants[sectionImage.size] | default('') %}
                  <img src="{{ sectionImage.src }}" alt="{{ sectionImage.alt }}" class="{{ options.images.globalStyle }} {{ imageVariant }} mx-auto">
                {% endif %}
              {% endif %}
            </div>
          </div>
        </div>
      </section>

      {# Standard Text Section for other variants #}
    {% else %}
      <section class="{{ globalStyle }} {{ variantStyle }} {{ options.class | default('') }} {% if variant.height %}{{ variant.height }}{% else %}py-16 md:py-20 lg:py-24{% endif %}">
        <div class="{{ containerStyle }}">
          <div class="{{ contentLayoutStyle.mobile }} {{ contentLayoutStyle.desktop }}">
            {# Text Content Column #}
            <div class="{{ textContainerStyle }}">
              {# SuperHeading #}
              {% if variant.superHeading and options.headings and options.headings.headings %}
                {% set superHeading = null %}
                {% for heading in options.headings.headings %}
                  {% if heading.name == variant.superHeading %}
                    {% set superHeading = heading %}
                  {% endif %}
                {% endfor %}

                {% if superHeading %}
                  <{{ "h" + superHeading.level }} class="{{ options.headings.globalStyle }} {{ options.headings.sizeStyles["h" + superHeading.level] }} {{ options.headings.variants[superHeading.style] }} max-w-[40rem] mx-auto">
                    {{ superHeading.text }}
                  </{{ "h" + superHeading.level }}>
                {% endif %}
              {% endif %}

              {# Main Heading #}
              {% if variant.heading and options.headings and options.headings.headings %}
                {% set mainHeading = null %}
                {% for heading in options.headings.headings %}
                  {% if heading.name == variant.heading %}
                    {% set mainHeading = heading %}
                  {% endif %}
                {% endfor %}

                {% if mainHeading %}
                  <{{ "h" + mainHeading.level }} class="{{ options.headings.globalStyle }} {{ options.headings.sizeStyles["h" + mainHeading.level] }} {{ options.headings.variants[mainHeading.style] }} max-w-[40rem] mx-auto">
                    {{ mainHeading.text }}
                  </{{ "h" + mainHeading.level }}>
                {% else %}
                  <h2 class="{{ options.headings.globalStyle }} {{ options.headings.sizeStyles.h2 }} {{ options.headings.variants.default }} max-w-[40rem] mx-auto">
                    {{ variant.heading }}
                  </h2>
                {% endif %}
              {% endif %}

              {# Multiple content sections - Iterate through numbered content blocks #}
              {% for i in range(1, 4) %}
                {% set headingKey = "heading_0" + i %}
                {% set contentKey = "content_0" + i %}
                
                {% if variant[headingKey] and options.headings and options.headings.headings %}
                  {% set sectionHeading = null %}
                  {% for heading in options.headings.headings %}
                    {% if heading.name == variant[headingKey] %}
                      {% set sectionHeading = heading %}
                    {% endif %}
                  {% endfor %}

                  {% if sectionHeading %}
                    <{{ "h" + sectionHeading.level }} class="{{ options.headings.globalStyle }} {{ options.headings.sizeStyles["h" + sectionHeading.level] }} {{ options.headings.variants[sectionHeading.style] }} max-w-[40rem] mx-auto mt-6 text-[theme(--ma-nautic-white)]">
                      {{ sectionHeading.text }}
                    </{{ "h" + sectionHeading.level }}>
                  {% endif %}
                {% endif %}
                
                {% if variant[contentKey] %}
                  <div class="my-4 [&_p]:mb-6 max-w-[40rem] mx-auto text-[theme(--ma-nautic-white)]">
                    {{ variant[contentKey] | safe }}
                  </div>
                {% endif %}
              {% endfor %}

              {# Description #}
              {% if variant.description %}
                <p class="{{ variant.descriptionStyle | default('') }} max-w-[40rem] mx-auto">
                  {{ variant.description }}
                </p>
              {% endif %}

              {# Content - For HTML content #}
              {% if variant.content %}
                <div class="{{ variant.contentStyle | default('') }} [&_p]:mb-6 max-w-[40rem] mx-auto">
                  {{ variant.content | safe }}
                </div>
              {% endif %}

              {# Text - New section to get text (addition) #}
              {% if variant.text %}
                <div class="{{ variant.textStyle | default('') }} [&_p]:mb-6 max-w-[40rem] mx-auto">
                  {{ variant.text | safe }}
                </div>
              {% endif %}

              {# Buttons Container #}
              <div class="{{ buttonsContainerStyle }}">
                {# Import button rendering macro #}
                {% from "03-atoms/button.njk" import renderButton %}

                {# Primary Button #}
                {% if variant.primaryButton %}
                  {{ renderButton({ 
                      name: variant.primaryButton,
                      datas: options.buttons
                  }) }}
                {% endif %}

                {# Secondary Button #}
                {% if variant.secondaryButton %}
                  {{ renderButton({ 
                      name: variant.secondaryButton,
                      datas: options.buttons
                  }) }}
                {% endif %}
                
                {# Standard link if defined #}
                {% if variant.link and options.links and options.links.links %}
                  {% set linkData = null %}
                  {% for link in options.links.links %}
                    {% if link.name | lower == variant.link | lower %}
                      {% set linkData = link %}
                    {% endif %}
                  {% endfor %}

                  {% if linkData %}
                    <a href="{{ linkData.href }}" class="{{ options.links.globalStyle }} {{ options.links.variants[linkData.style] }} mt-6">
                      {{ linkData.text }}
                    </a>
                  {% endif %}
                {% endif %}
              </div>
            </div>

            {# Image Column - Display only if hasImage is true and not an imageOnly section #}
            {% if hasImage and not imageOnlySection %}
              <div class="{{ imageContainerStyle }}">
                {% if variant.image and options.images and options.images.images %}
                  {% set sectionImage = null %}
                  {% for image in options.images.images %}
                    {% if image.name == variant.image %}
                      {% set sectionImage = image %}
                    {% endif %}
                  {% endfor %}

                  {% if sectionImage %}
                    {% set imageVariant = options.images.variants[sectionImage.size] | default('') %}
                    <img src="{{ sectionImage.src }}" alt="{{ sectionImage.alt }}" class="{{ options.images.globalStyle }} {{ imageVariant }} mx-auto">
                  {% endif %}
                {% endif %}
              </div>
            {% endif %}
          </div>
        </div>
      </section>
    {% endif %}
  {% else %}
    <span class="text-red-500">Section Text data not found</span>
  {% endif %}
{% endmacro %}

{#
============================
Summon HAT Components Wisely
============================

1. Import the macro at the top of your page
{% from "01-organisms/section-text.njk" import renderSectionText %}

2. Call a specific section-text by its name
{{ renderSectionText({ 
    name: "default_text",
    datas: organisms["section-texts"],
    headings: atoms.headings,
    buttons: atoms.buttons,
    images: atoms.images,
    links: atoms.links
}) }}

May your bugs be forever exiled to the shadow realm. 🧙‍♂️✨
#}