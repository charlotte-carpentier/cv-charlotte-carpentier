{# 
=========================
    SKILLS-CARD ORGANISM
    v1.5 - Desktop + Tablette unifiée       
=========================
#}

{# Import molecules and atoms #}
{% from "02-molecules/caption.njk" import renderCaption %}
{% from "03-atoms/typography.njk" import renderTypography %}

{% macro renderSkillsCard(option) %}
  {# Check if datas is provided #}
  {% if not option.datas %}
    <span class="text-red-500">Error: No skills-card configuration provided</span>
  {% else %}
    {# Retrieve skills-card configuration #}
    {% set skillsCardConfig = option.datas %}
    {% set skillsCardName = option.name %}
    
    {# Find the specific skills-card by name #}
    {% set skillsCardData = null %}
    {% for skillsCard in skillsCardConfig %}
      {% if skillsCard.name == skillsCardName %}
        {% set skillsCardData = skillsCard %}
      {% endif %}
    {% endfor %}

    {# Fallback if skills-card not found #}
    {% if not skillsCardData %}
      <span class="text-red-500">Skills-card not found: {{ skillsCardName }}</span>
    {% else %}
      {# Calculate mystery chests needed for DESKTOP only #}
      {% set totalSlots = 4 if skillsCardData.grid_layout == "2x2" else 6 %}
      {% set existingItems = skillsCardData.captions.length %}
      {% set missingSlots = totalSlots - existingItems %}
      
      {# Skills Card Container #}
      <div class="skills-card skills-card--{{ skillsCardData.theme }}" data-skills="{{ skillsCardData.name }}">
        
        {# Desktop version: Individual card with tooltips #}
        <div class="skills-card-desktop">
          <div class="skills-card-content">
            
            {# Card title #}
            <div class="skills-card-title">
              {{ renderTypography({ 
                name: skillsCardData.title,
                datas: option.typography_datas
              }) }}
            </div>
            
            {# Card captions grid #}
            <div class="skills-card-grid skills-card-grid--{{ skillsCardData.grid_layout }}">
              
              {# Render existing captions #}
              {% for captionName in skillsCardData.captions %}
                <div class="skills-card-item">
                  {{ renderCaption({ 
                    name: captionName,
                    datas: option.caption_datas,
                    iconDatas: option.icon_datas,
                    tooltipDatas: option.tooltip_datas
                  }) }}
                </div>
              {% endfor %}
              
              {# Add mystery chests for empty slots #}
              {% for i in range(missingSlots) %}
                <div class="skills-card-item">
                  {{ renderCaption({ 
                    name: "skills_treasure",
                    datas: option.caption_datas,
                    iconDatas: option.icon_datas,
                    tooltipDatas: option.tooltip_datas
                  }) }}
                </div>
              {% endfor %}
              
            </div>
          </div>
        </div>

        {# Tablette version: Layout avec descriptions visibles #}
        <div class="skills-card-tablet">
          <div class="skills-card-tablet-content">
            
            {# Card title #}
            <div class="skills-card-tablet-title">
              {{ renderTypography({ 
                name: skillsCardData.title,
                datas: option.typography_datas
              }) }}
            </div>
            
            {# Card captions list #}
            <div class="skills-card-tablet-list">
              
              {# Render existing captions avec version mobile (description visible) #}
              {% for captionName in skillsCardData.captions %}
                <div class="skills-card-tablet-item">
                  {{ renderCaption({ 
                    name: captionName,
                    datas: option.caption_datas,
                    iconDatas: option.icon_datas,
                    tooltipDatas: option.tooltip_datas
                  }) }}
                </div>
              {% endfor %}
              
            </div>
          </div>
        </div>

        {# Mobile version: À implémenter plus tard #}
        <div class="skills-card-mobile">
          <div class="skills-card-mobile-content">
            {# TODO: Mobile version #}
          </div>
        </div>
      </div>
    {% endif %}
  {% endif %}
{% endmacro %}

{# 
============================
Usage des Skills Cards
============================

1. Import de la macro
{% from "01-organisms/skills-card.njk" import renderSkillsCard %}

2. Utilisation individuelle pour chaque carte

{{ renderSkillsCard({ 
    name: "soft_skills_card",
    datas: organisms["skills-card"]["skills-cards"],
    typography_datas: atoms.typography.texts,
    caption_datas: molecules.caption.captions,
    icon_datas: atoms.icon.icons,
    tooltip_datas: atoms.tooltip.tooltips
}) }}

{{ renderSkillsCard({ 
    name: "hard_skills_card",
    datas: organisms["skills-card"]["skills-cards"],
    typography_datas: atoms.typography.texts,
    caption_datas: molecules.caption.captions,
    icon_datas: atoms.icon.icons,
    tooltip_datas: atoms.tooltip.tooltips
}) }}

3. Layout en tablette : les 2 cartes seront côte à côte automatiquement
#}